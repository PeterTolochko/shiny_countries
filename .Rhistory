scale_x_continuous(breaks = seq(from = 0, to = 28, by = 5),
labels = seq(from = 1990, to = 2018, by = 5)) +
theme_tufte() +
theme(axis.title.x = element_blank()) +
ggtitle('North America')
year_effects <- get_effects(predict_topics, 'year_diff', 'continuous',
moderator = 'region',
modval = 'Europe')
year_effects %>%
filter(value != 'None',
topic %in% top_5_clusters | topic %in% c('4: 7+34+4', '17: 57+51+29')) %>% # add taxonomy
ggplot() +
geom_line(aes(value, proportion, group = factor(topic),
color = factor(topic))) +
geom_line(aes(value, lower, group = factor(topic), color = factor(topic)),
linetype = 2,
alpha = 1/2) +
geom_line(aes(value, upper, group = factor(topic), color = factor(topic)),
linetype = 2,
alpha = 1/2) +
geom_ribbon(aes(x = value,
ymin = upper,
ymax = lower,
fill = factor(topic)),
alpha = 1/4) +
ylim(0, .20) +
scale_color_brewer(name = 'Cluster', type = 'qual', palette = 2, breaks = topics,
labels = cluster_names_70) +
scale_fill_brewer(name = 'Cluster', type = 'qual', palette = 2, breaks = topics,
labels = cluster_names_70) +
ylab('Cluster Prevalence') +
scale_x_continuous(breaks = seq(from = 0, to = 28, by = 5),
labels = seq(from = 1990, to = 2018, by = 5)) +
theme_tufte() +
theme(axis.title.x = element_blank()) +
ggtitle('Europe')
year_effects <- get_effects(predict_topics, 'year_diff', 'continuous',
moderator = 'region',
modval = 'South America')
year_effects %>%
filter(value != 'None',
topic %in% top_5_clusters | topic %in% c('4: 7+34+4', '17: 57+51+29')) %>% # add taxonomy
ggplot() +
geom_line(aes(value, proportion, group = factor(topic),
color = factor(topic))) +
geom_line(aes(value, lower, group = factor(topic), color = factor(topic)),
linetype = 2,
alpha = 1/2) +
geom_line(aes(value, upper, group = factor(topic), color = factor(topic)),
linetype = 2,
alpha = 1/2) +
geom_ribbon(aes(x = value,
ymin = upper,
ymax = lower,
fill = factor(topic)),
alpha = 1/4) +
ylim(0, .20) +
scale_color_brewer(name = 'Cluster', type = 'qual', palette = 2, breaks = topics,
labels = cluster_names_70) +
scale_fill_brewer(name = 'Cluster', type = 'qual', palette = 2, breaks = topics,
labels = cluster_names_70) +
ylab('Cluster Prevalence') +
scale_x_continuous(breaks = seq(from = 0, to = 28, by = 5),
labels = seq(from = 1990, to = 2018, by = 5)) +
theme_tufte() +
theme(axis.title.x = element_blank()) +
ggtitle('South America')
year_effects <- get_effects(predict_topics, 'year_diff', 'continuous',
moderator = 'region',
modval = 'Asia')
year_effects %>%
filter(value != 'None',
topic %in% top_5_clusters | topic %in% c('4: 7+34+4', '17: 57+51+29')) %>% # add taxonomy
ggplot() +
geom_line(aes(value, proportion, group = factor(topic),
color = factor(topic))) +
geom_line(aes(value, lower, group = factor(topic), color = factor(topic)),
linetype = 2,
alpha = 1/2) +
geom_line(aes(value, upper, group = factor(topic), color = factor(topic)),
linetype = 2,
alpha = 1/2) +
geom_ribbon(aes(x = value,
ymin = upper,
ymax = lower,
fill = factor(topic)),
alpha = 1/4) +
ylim(0, .20) +
scale_color_brewer(name = 'Cluster', type = 'qual', palette = 2, breaks = topics,
labels = cluster_names_70) +
scale_fill_brewer(name = 'Cluster', type = 'qual', palette = 2, breaks = topics,
labels = cluster_names_70) +
ylab('Cluster Prevalence') +
scale_x_continuous(breaks = seq(from = 0, to = 28, by = 5),
labels = seq(from = 1990, to = 2018, by = 5)) +
theme_tufte() +
theme(axis.title.x = element_blank()) +
ggtitle('Asia')
current_region <- 'Europe'
year_effects <- get_effects(predict_topics, 'year_diff', 'continuous',
moderator = 'region',
modval = current_region)
top_5_clusters <- year_effects %>%
group_by(topic) %>%
summarise(mean_prop = mean(proportion)) %>%
slice_max(mean_prop, n = 5) %>%
pull(topic)
current_region <- 'Europe'
year_effects <- get_effects(predict_topics, 'year_diff', 'continuous',
moderator = 'region',
modval = current_region)
year_effects %>%
filter(value != 'None',
topic %in% top_5_clusters | topic %in% c('4: 7+34+4', '17: 57+51+29')) %>% # add taxonomy
ggplot() +
geom_line(aes(value, proportion, group = factor(topic),
color = factor(topic))) +
geom_line(aes(value, lower, group = factor(topic), color = factor(topic)),
linetype = 2,
alpha = 1/2) +
geom_line(aes(value, upper, group = factor(topic), color = factor(topic)),
linetype = 2,
alpha = 1/2) +
geom_ribbon(aes(x = value,
ymin = upper,
ymax = lower,
fill = factor(topic)),
alpha = 1/4) +
ylim(0, .20) +
scale_color_brewer(name = 'Cluster', type = 'qual', palette = 2, breaks = topics,
labels = cluster_names_70) +
scale_fill_brewer(name = 'Cluster', type = 'qual', palette = 2, breaks = topics,
labels = cluster_names_70) +
ylab('Cluster Prevalence') +
scale_x_continuous(breaks = seq(from = 0, to = 28, by = 5),
labels = seq(from = 1990, to = 2018, by = 5)) +
theme_tufte() +
theme(axis.title.x = element_blank()) +
ggtitle(current_region)
current_region <- 'North America'
year_effects <- get_effects(predict_topics, 'year_diff', 'continuous',
moderator = 'region',
modval = current_region)
year_effects %>%
filter(value != 'None',
topic %in% top_5_clusters | topic %in% c('4: 7+34+4', '17: 57+51+29')) %>% # add taxonomy
ggplot() +
geom_line(aes(value, proportion, group = factor(topic),
color = factor(topic))) +
geom_line(aes(value, lower, group = factor(topic), color = factor(topic)),
linetype = 2,
alpha = 1/2) +
geom_line(aes(value, upper, group = factor(topic), color = factor(topic)),
linetype = 2,
alpha = 1/2) +
geom_ribbon(aes(x = value,
ymin = upper,
ymax = lower,
fill = factor(topic)),
alpha = 1/4) +
ylim(0) +
scale_color_brewer(name = 'Cluster', type = 'qual', palette = 2, breaks = topics,
labels = cluster_names_70) +
scale_fill_brewer(name = 'Cluster', type = 'qual', palette = 2, breaks = topics,
labels = cluster_names_70) +
ylab('Cluster Prevalence') +
scale_x_continuous(breaks = seq(from = 0, to = 28, by = 5),
labels = seq(from = 1990, to = 2018, by = 5)) +
theme_tufte() +
theme(axis.title.x = element_blank()) +
ggtitle(current_region)
year_effects %>%
filter(value != 'None',
topic %in% top_5_clusters | topic %in% c('4: 7+34+4', '17: 57+51+29')) %>% # add taxonomy
ggplot() +
geom_line(aes(value, proportion, group = factor(topic),
color = factor(topic))) +
geom_line(aes(value, lower, group = factor(topic), color = factor(topic)),
linetype = 2,
alpha = 1/2) +
geom_line(aes(value, upper, group = factor(topic), color = factor(topic)),
linetype = 2,
alpha = 1/2) +
geom_ribbon(aes(x = value,
ymin = upper,
ymax = lower,
fill = factor(topic)),
alpha = 1/4) +
ylim(c(0, NA)) +
scale_color_brewer(name = 'Cluster', type = 'qual', palette = 2, breaks = topics,
labels = cluster_names_70) +
scale_fill_brewer(name = 'Cluster', type = 'qual', palette = 2, breaks = topics,
labels = cluster_names_70) +
ylab('Cluster Prevalence') +
scale_x_continuous(breaks = seq(from = 0, to = 28, by = 5),
labels = seq(from = 1990, to = 2018, by = 5)) +
theme_tufte() +
theme(axis.title.x = element_blank()) +
ggtitle(current_region)
current_region <- 'South America'
year_effects <- get_effects(predict_topics, 'year_diff', 'continuous',
moderator = 'region',
modval = current_region)
year_effects %>%
filter(value != 'None',
topic %in% top_5_clusters | topic %in% c('4: 7+34+4', '17: 57+51+29')) %>% # add taxonomy
ggplot() +
geom_line(aes(value, proportion, group = factor(topic),
color = factor(topic))) +
geom_line(aes(value, lower, group = factor(topic), color = factor(topic)),
linetype = 2,
alpha = 1/2) +
geom_line(aes(value, upper, group = factor(topic), color = factor(topic)),
linetype = 2,
alpha = 1/2) +
geom_ribbon(aes(x = value,
ymin = upper,
ymax = lower,
fill = factor(topic)),
alpha = 1/4) +
ylim(c(0, NA)) +
scale_color_brewer(name = 'Cluster', type = 'qual', palette = 2, breaks = topics,
labels = cluster_names_70) +
scale_fill_brewer(name = 'Cluster', type = 'qual', palette = 2, breaks = topics,
labels = cluster_names_70) +
ylab('Cluster Prevalence') +
scale_x_continuous(breaks = seq(from = 0, to = 28, by = 5),
labels = seq(from = 1990, to = 2018, by = 5)) +
theme_tufte() +
theme(axis.title.x = element_blank()) +
ggtitle(current_region)
year_effects %>%
filter(value != 'None',
topic %in% top_5_clusters | topic %in% c('4: 7+34+4', '17: 57+51+29')) %>% # add taxonomy
ggplot() +
geom_line(aes(value, proportion, group = factor(topic),
color = factor(topic))) +
geom_line(aes(value, lower, group = factor(topic), color = factor(topic)),
linetype = 2,
alpha = 1/2) +
geom_line(aes(value, upper, group = factor(topic), color = factor(topic)),
linetype = 2,
alpha = 1/2) +
geom_ribbon(aes(x = value,
ymin = upper,
ymax = lower,
fill = factor(topic)),
alpha = 1/4) +
ylim(c(0, .4)) +
scale_color_brewer(name = 'Cluster', type = 'qual', palette = 2, breaks = topics,
labels = cluster_names_70) +
scale_fill_brewer(name = 'Cluster', type = 'qual', palette = 2, breaks = topics,
labels = cluster_names_70) +
ylab('Cluster Prevalence') +
scale_x_continuous(breaks = seq(from = 0, to = 28, by = 5),
labels = seq(from = 1990, to = 2018, by = 5)) +
theme_tufte() +
theme(axis.title.x = element_blank()) +
ggtitle(current_region)
year_effects %>%
filter(value != 'None',
topic %in% top_5_clusters | topic %in% c('4: 7+34+4', '17: 57+51+29')) %>% # add taxonomy
ggplot() +
geom_line(aes(value, proportion, group = factor(topic),
color = factor(topic))) +
geom_line(aes(value, lower, group = factor(topic), color = factor(topic)),
linetype = 2,
alpha = 1/2) +
geom_line(aes(value, upper, group = factor(topic), color = factor(topic)),
linetype = 2,
alpha = 1/2) +
geom_ribbon(aes(x = value,
ymin = upper,
ymax = lower,
fill = factor(topic)),
alpha = 1/4) +
ylim(c(0, .3)) +
scale_color_brewer(name = 'Cluster', type = 'qual', palette = 2, breaks = topics,
labels = cluster_names_70) +
scale_fill_brewer(name = 'Cluster', type = 'qual', palette = 2, breaks = topics,
labels = cluster_names_70) +
ylab('Cluster Prevalence') +
scale_x_continuous(breaks = seq(from = 0, to = 28, by = 5),
labels = seq(from = 1990, to = 2018, by = 5)) +
theme_tufte() +
theme(axis.title.x = element_blank()) +
ggtitle(current_region)
current_region <- 'Asia'
year_effects <- get_effects(predict_topics, 'year_diff', 'continuous',
moderator = 'region',
modval = current_region)
year_effects %>%
filter(value != 'None',
topic %in% top_5_clusters | topic %in% c('4: 7+34+4', '17: 57+51+29')) %>% # add taxonomy
ggplot() +
geom_line(aes(value, proportion, group = factor(topic),
color = factor(topic))) +
geom_line(aes(value, lower, group = factor(topic), color = factor(topic)),
linetype = 2,
alpha = 1/2) +
geom_line(aes(value, upper, group = factor(topic), color = factor(topic)),
linetype = 2,
alpha = 1/2) +
geom_ribbon(aes(x = value,
ymin = upper,
ymax = lower,
fill = factor(topic)),
alpha = 1/4) +
ylim(c(0, .3)) +
scale_color_brewer(name = 'Cluster', type = 'qual', palette = 2, breaks = topics,
labels = cluster_names_70) +
scale_fill_brewer(name = 'Cluster', type = 'qual', palette = 2, breaks = topics,
labels = cluster_names_70) +
ylab('Cluster Prevalence') +
scale_x_continuous(breaks = seq(from = 0, to = 28, by = 5),
labels = seq(from = 1990, to = 2018, by = 5)) +
theme_tufte() +
theme(axis.title.x = element_blank()) +
ggtitle(current_region)
current_region <- 'Oceania'
year_effects <- get_effects(predict_topics, 'year_diff', 'continuous',
moderator = 'region',
modval = current_region)
year_effects %>%
filter(value != 'None',
topic %in% top_5_clusters | topic %in% c('4: 7+34+4', '17: 57+51+29')) %>% # add taxonomy
ggplot() +
geom_line(aes(value, proportion, group = factor(topic),
color = factor(topic))) +
geom_line(aes(value, lower, group = factor(topic), color = factor(topic)),
linetype = 2,
alpha = 1/2) +
geom_line(aes(value, upper, group = factor(topic), color = factor(topic)),
linetype = 2,
alpha = 1/2) +
geom_ribbon(aes(x = value,
ymin = upper,
ymax = lower,
fill = factor(topic)),
alpha = 1/4) +
ylim(c(0, .3)) +
scale_color_brewer(name = 'Cluster', type = 'qual', palette = 2, breaks = topics,
labels = cluster_names_70) +
scale_fill_brewer(name = 'Cluster', type = 'qual', palette = 2, breaks = topics,
labels = cluster_names_70) +
ylab('Cluster Prevalence') +
scale_x_continuous(breaks = seq(from = 0, to = 28, by = 5),
labels = seq(from = 1990, to = 2018, by = 5)) +
theme_tufte() +
theme(axis.title.x = element_blank()) +
ggtitle(current_region)
require(tidyverse)
require(ggthemes)
getwd()
setwd("~/Desktop/country_dashboard/")
data <- read_csv("wos_data_wit_collab.csv")
names(data)
head(data$cluster_70_names)
head(data$country_fa)
country_name <- "Greece"
wos_data %>%
filter(country_fa == country_name)
data %>%
filter(country_fa == country_name)
data %>%
filter(country_fa == country_name) %>%
group_by(cluster_70_names) %>%
count()
plot.title = element_text(hjust = .5)) +
coord_flip()
regional_dist <- data %>%
filter(country_fa == country_name) %>%
group_by(cluster_70_names) %>%
count() %>%
ungroup() %>%
mutate(rel_freq = n / sum(n) * 100) %>%
ggplot() +
geom_bar(aes(x = reorder(cluster_70_names, rel_freq), rel_freq), stat = 'identity',
fill = 'steelblue') +
ylab(paste0(country_name, ': Relative Frequency of Clusters (%)')) +
xlab(NULL) +
theme_tufte() +
theme(
plot.title = element_text(hjust = .5)) +
coord_flip()
regional_dist
top_5 <- current_data %>%
filter(country_fa == country_name) %>%
group_by(cluster_70_names) %>%
count() %>%
arrange(-n) %>%
ungroup() %>%
top_n(5) %>%
select(cluster_70_names)
top_5 <- country_name %>%
filter(country_fa == country_name) %>%
group_by(cluster_70_names) %>%
count() %>%
arrange(-n) %>%
ungroup() %>%
top_n(5) %>%
select(cluster_70_names)
top_5 <- data %>%
filter(country_fa == country_name) %>%
group_by(cluster_70_names) %>%
count() %>%
arrange(-n) %>%
ungroup() %>%
top_n(5) %>%
select(cluster_70_names)
top_5
p <- data %>%
filter(cluster_70_names %in% top_10$cluster_70_names) %>%
group_by(PY, cluster_70_names) %>%
count() %>%
group_by(cluster_70_names) %>%
mutate(cumulative = cumsum(n)) %>%
ggplot() +
geom_line(aes(PY, cumulative, color = factor(cluster_70_names))) +
theme_tufte() +
ggtitle(paste0('Cumulative Sum of Clusters Over Time (Top 10 Clusters); ', my_region)) +
theme(legend.title = element_blank())
p <- data %>%
filter(cluster_70_names %in% top_5$cluster_70_names) %>%
group_by(PY, cluster_70_names) %>%
count() %>%
group_by(cluster_70_names) %>%
mutate(cumulative = cumsum(n)) %>%
ggplot() +
geom_line(aes(PY, cumulative, color = factor(cluster_70_names))) +
theme_tufte() +
ggtitle(paste0('Cumulative Sum of Clusters Over Time (Top 10 Clusters); ', my_region)) +
theme(legend.title = element_blank())
p <- data %>%
filter(cluster_70_names %in% top_5$cluster_70_names) %>%
group_by(PY, cluster_70_names) %>%
count() %>%
group_by(cluster_70_names) %>%
mutate(cumulative = cumsum(n)) %>%
ggplot() +
geom_line(aes(PY, cumulative, color = factor(cluster_70_names))) +
theme_tufte() +
ggtitle(paste0('Cumulative Sum of Clusters Over Time (Top 10 Clusters); ', country_name)) +
theme(legend.title = element_blank())
p
p <- data %>%
filter(cluster_70_names %in% top_5$cluster_70_names) %>%
group_by(PY, cluster_70_names) %>%
count() %>%
group_by(cluster_70_names) %>%
mutate(cumulative = n) %>%
ggplot() +
geom_line(aes(PY, cumulative, color = factor(cluster_70_names))) +
theme_tufte() +
ggtitle(paste0('Cumulative Sum of Clusters Over Time (Top 10 Clusters); ', country_name)) +
theme(legend.title = element_blank())
p
p <- data %>%
filter(cluster_70_names %in% top_5$cluster_70_names) %>%
group_by(PY, cluster_70_names) %>%
count() %>%
group_by(cluster_70_names) %>%
mutate(cumulative = n) %>%
ggplot() +
geom_line(aes(PY, cumulative, color = factor(cluster_70_names))) +
theme_tufte() +
ggtitle(paste0('Top 5 Cluster Over Time; ', country_name)) +
theme(legend.title = element_blank(),
axis.title.x = element_blank())
p
p <- data %>%
filter(cluster_70_names %in% top_5$cluster_70_names) %>%
group_by(PY, cluster_70_names) %>%
count() %>%
group_by(cluster_70_names) %>%
mutate(cumulative = n) %>%
ggplot() +
geom_line(aes(PY, cumulative, color = factor(cluster_70_names))) +
theme_tufte() +
ggtitle(paste0('Top 5 Cluster Over Time; ', country_name)) +
theme(legend.title = element_blank(),
axis.title.x = element_blank(),
axis.title.y = element_text("Number of Articles"))
p
p <- data %>%
filter(cluster_70_names %in% top_5$cluster_70_names) %>%
group_by(PY, cluster_70_names) %>%
count() %>%
group_by(cluster_70_names) %>%
mutate(cumulative = n) %>%
ggplot() +
geom_line(aes(PY, cumulative, color = factor(cluster_70_names))) +
theme_tufte() +
ggtitle(paste0('Top 5 Cluster Over Time; ', country_name)) +
theme(legend.title = element_blank(),
axis.title.x = element_blank(),
axis.title.y = element_text(text="Number of Articles"))
p
p <- data %>%
filter(cluster_70_names %in% top_5$cluster_70_names) %>%
group_by(PY, cluster_70_names) %>%
count() %>%
group_by(cluster_70_names) %>%
mutate(cumulative = n) %>%
ggplot() +
geom_line(aes(PY, cumulative, color = factor(cluster_70_names))) +
theme_tufte() +
ylab("Number of Articles") +
ggtitle(paste0('Top 5 Cluster Over Time; ', country_name)) +
theme(legend.title = element_blank(),
axis.title.x = element_blank())
p
